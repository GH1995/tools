
自动命令
============

自动命令可以让Vim自动执行某些指定的命令，这些指定的命令会在某些事件发生的时候执行。我们先看一个例子。

使用`:edit foo`打开一个新文件，然后立即使用`:quit`关闭。查看你的硬盘，你会发现这个文件并不存在。这是因为在你第一次保存这个文件之前，Vim*实际上*并没有真正创建它。

让我们对Vim做一些改变，使得Vim可以在你开始编辑文件的时候就创建它们。执行下面的命令：

    :autocmd BufNewFile * :write

自动命令结构
---------------------

让我们来深入分析下我们刚才创建的自动命令：

    :autocmd BufNewFile * :write
             ^          ^ ^
             |          | |
             |          | 要执行的命令
             |          |
             |          用于事件过滤的“模式（pattern）”
             |
             要监听的“事件”

这个命令的第一部分是我们想监听的事件的类型。Vim提供了*很多*可以监听的事件。这些事件包括：

* 开始编辑一个当前并不存在的文件。
* 读取一个文件，不管这个文件是否存在。
* 改变一个缓冲区的`filetype`设置。
* 在某段时间内不按下键盘上面的某个按键。
* 进入插入模式。
* 退出插入模式。

这个自动命令的下一部分是一个“模式”，这个模式可以进一步限定你要执行的命令的执行范围。新开一个Vim实例，执行下面的命令：

    :autocmd BufNewFile *.txt :write

这个跟之前的那个自动命令基本一样，不过这个自动命令只对后缀为`.txt`的文件有效，也就是说当你新建的文件为txt文件的时候，Vim会在文件创建的时候自动执行write命令将文件保存到硬盘上。

这个自动命令的最后一部分是事件发生时我们想执行的命令。这个部分很容易理解，跟我们执行其他命令一样，除了不能在这个命令中使用特殊的字符，例如`<cr>`。我们会在本书后面的章节中谈论如何突破这个限制，现在你只需要遵守它就可以。

再来一个示例
---------------

我们再定义一个自动命令，这次使用一个不同的事件。执行下面的命令：

    :autocmd BufWritePre *.html :normal gg=G

执行`:w`保存这个文件。看看会发生了什么？Vim似乎在文件保存之前重新进行了文本缩进处理。

多个事件
---------------

你可以创建一个绑定*多个*事件的自动命令，这些事件使用逗号分隔开。执行下面的命令：

    :autocmd BufWritePre,BufRead *.html :normal gg=G

在Vim脚本编程中有一个不成文的规定，你应该同时使用`BufRead`和`BufNewFile`（译注：这里不是BufWritePre）这两个事件来运行命令，这样当你打开某个类型的文件，不论这个文件是否存在命令都会执行。执行下面的命令：

    :autocmd BufNewFile,BufRead *.html setlocal nowrap

上面的命令会使得无论你在什么时候编辑HTML文件自动换行都会被关闭。

FileType事件
---------------

最有用的事件是`FileType`事件。这个事件会在Vim设置一个缓冲区的`filetype`的时候触发。

让我们针对不同文件类型设置一些有用的映射。运行命令：

    :autocmd FileType javascript nnoremap <buffer> <localleader>c I//<esc>
    :autocmd FileType python     nnoremap <buffer> <localleader>c I#<esc>

打开一个Javascript文件（后缀为`.js`的文件）,将光标移动到某一行，敲击`<localleader>c`，光标所在的那一行会被注释掉。

在自动命令中包含我们上一章中学到的本地缓冲区映射，我们可以创建一些映射，这些映射会根据我们正在编辑的文件的类型来进行不同的处理。

